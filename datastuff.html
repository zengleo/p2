<html>
<script src='https://d3js.org/d3.v5.min.js'></script>
  <style> circle {fill: lightblue; stroke: black;} </style>
  <body>
    <h1>Interactive Dataset</h1>
    <label for="plot">Plot</label>
    <svg id="plot" width=500 height=500></svg>
    <script>
      function graph(f,v){
        var x = d3.scaleLinear().domain([40,100]).range([0,400])
        var y = d3.scaleLinear().domain([40,100]).range([400,0])
        var data = d3.csv('/p2/test_scores.csv');

        d3.select("svg").append("g").attr("transform","translate(50,50)")
        .selectAll("circle").data(d).enter().append("circle")
        .attr("cx",function(d) {return x(d.pretest);})
        .attr("cy",function(d) {return y(d.posttest);})
        .attr("r",3)

        d3.select("svg").append("g").attr("transform","translate(50,50)").call(d3.axisLeft(y));
        d3.select("svg").append("g").attr("transform","translate(50,450)").call(d3.axisBottom(x));
      }
      function filter(arr, criteria) {
        return arr.filter(function(obj) {
          return Object.keys(criteria).every(function(c) {
            return obj[c] == criteria[c];
          });
        });
      }
     
    </script>
    <label for="field">Choose a field:</label>

    <select id="field" onchange="generate(this.value);">
      <option value="n_student">Class Size</option>
      <option value="school_setting">School Setting</option>
      <option value="school_type">School Type</option>
      <option value="teaching_method">Teaching Method</option>
      <option value="gender">Gender</option>
      <option value="lunch" selected>Subsidized Lunch</option>
    </select>
    <div id="container"></div>
    <button onclick="bclick(document.getElementById("field").value, document.getElementById("glist").value);">Refresh</button>
    <button onclick="window.location.href='/p2/index.html'">Back</button>
    <script>
      function generate(field) {
 
        //var field = "lunch"
        var data = d3.csv('/p2/test_scores.csv');
        var flags = [], output = [], l = data.length, i;
        for( i=0; i<l; i++) {
          if( flags[data[i][field]]) continue;
          flags[data[i][field]] = true;
          output.push(data[i][field]);
        }

        var select = document.createElement("select");
        select.name = "glist";
        select.id = "glist"

        for (const val of output)
        {
            var option = document.createElement("option");
            option.value = val;
            option.text = val;
            select.appendChild(option);
        }

        var label = document.createElement("label");
        label.innerHTML = "Choose a value"
        label.htmlFor = "glist";

        document.getElementById("container").appendChild(label).appendChild(select);
      }
      function bclick(field, value) {
        var data = d3.csv('/p2/test_scores.csv');
        var d = filter(data, {field: value})
        document.getElementById("plot").innerHTML = field + ": " + value
        graph(field,value)
      }
    </script>
  </body>
</html>
